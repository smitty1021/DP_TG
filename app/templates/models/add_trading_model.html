{% extends "base.html" %}
{% from "macros/_form_helpers.html" import render_field, render_checkbox %}

{% block title %}
    {{ title or "Strategic Trading Model Configuration" }} - Enterprise Trading Platform
{% endblock %}

{% block head_extra %}
<!-- Fortune 500 Enterprise CSS Framework -->
<link rel="stylesheet" href="/static/css/enterprise-all.css">
{% endblock %}

{% block page_header %}
<div class="executive-header">
    <div class="enterprise-container">
        <div class="d-flex justify-content-between align-items-center">
            <div class="header-content">
                <h1 class="executive-title">
                    <i class="fas fa-plus-circle executive-icon"></i>
                    Strategic Trading Model Configuration Center
                </h1>
                <div class="executive-subtitle">
                    Enterprise Trading Strategy Development & Implementation Framework
                </div>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-outline-secondary btn-sm"
                        onclick="window.location.href='{{ url_for('trading_models.models_list') }}'"
                        title="Return to Models Dashboard">
                    <i class="fas fa-list"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm"
                        onclick="location.reload()" title="Refresh Form">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm"
                        onclick="history.back();" title="Go Back">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="enterprise-container-fluid" style="width: 100%; max-width: none; padding-left: 2rem; padding-right: 2rem;">
    <!-- Enterprise Trading Model Configuration Form -->
    <form method="POST" action="{{ url_for('trading_models.add_trading_model') }}" novalidate>
        {{ form.hidden_tag() }}

        <!-- Model Identification Module -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-tag module-icon"></i>
                    Model Identification & Configuration
                </div>
                <div class="module-meta">Strategic Trading Model Core Information</div>
            </div>
            <div class="module-content">
                <div class="row mb-3">
                    <div class="col-md-7">
                        {{ render_field(form.name, label_visible=true, input_class="form-control form-control-lg", placeholder="e.g., 0930 Open ES Strategy") }}
                    </div>
                    <div class="col-md-3">
                        {{ render_field(form.version, label_visible=true, input_class="form-control", placeholder="e.g., 1.0") }}
                    </div>
                    <div class="col-md-2 d-flex align-items-end pb-2">
                        {{ render_checkbox(form.is_active, input_class="form-check-input-lg") }}
                    </div>
                </div>
                {{ render_field(form.overview_logic, label_visible=true, input_class="form-control", rows="3", placeholder="Brief description of the model's core logic and purpose.") }}
            </div>
        </div>

        <!-- Timeframe Configuration Module -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-clock module-icon"></i>
                    Timeframe Configuration Matrix
                </div>
                <div class="module-meta">Multi-Timeframe Analysis Framework Setup</div>
            </div>
            <div class="module-content">
                <div class="row">
                    <div class="col-md-4">
                        {{ render_field(form.primary_chart_tf, label_visible=true, input_class="form-control", placeholder="e.g., 15-Minute (Analysis/Setup)") }}
                    </div>
                    <div class="col-md-4">
                        {{ render_field(form.execution_chart_tf, label_visible=true, input_class="form-control", placeholder="e.g., 1-Minute (Entry/Fine-tuning)") }}
                    </div>
                    <div class="col-md-4">
                        {{ render_field(form.context_chart_tf, label_visible=true, input_class="form-control", placeholder="e.g., 1-Hour (Context/Trend)") }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Technical Analysis Module -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-chart-line module-icon"></i>
                    Technical Analysis Framework
                </div>
                <div class="module-meta">Strategic Market Analysis & Signal Generation Components</div>
            </div>
            <div class="module-content">
                {{ render_field(form.technical_indicators_used, label_visible=true, input_class="form-control", rows="3", placeholder="List indicators and their settings, e.g., EMA (9), RSI (14)") }}
                {{ render_field(form.chart_patterns_used, label_visible=true, input_class="form-control", rows="2", placeholder="e.g., Head and Shoulders, Triangles, Flags") }}
                {{ render_field(form.price_action_signals, label_visible=true, input_class="form-control", rows="2", placeholder="e.g., Engulfing Candles, Pin Bars at Key Levels") }}
                {{ render_field(form.key_levels_identification, label_visible=true, input_class="form-control", rows="2", placeholder="How are S/R, pivot points, Fibonacci levels identified?") }}
                {{ render_field(form.volume_analysis_notes, label_visible=true, input_class="form-control", rows="2", placeholder="How is volume used (if applicable)?") }}
                {{ render_field(form.fundamental_analysis_notes, label_visible=true, input_class="form-control", rows="2", placeholder="Any fundamental considerations (e.g., news events to avoid)?") }}
            </div>
        </div>

        <!-- Market Conditions Module -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-chart-area module-icon"></i>
                    Market Applicability & Conditions Framework
                </div>
                <div class="module-meta">Strategic Market Environment & Session Configuration</div>
            </div>
            <div class="module-content">
                {{ render_field(form.instrument_applicability, label_visible=true, input_class="form-control", rows="2", placeholder="e.g., NQ, ES, specific stocks") }}
                {{ render_field(form.session_applicability, label_visible=true, input_class="form-control", rows="2", placeholder="e.g., London Open, NY Open, specific hours") }}
                {{ render_field(form.optimal_market_conditions, label_visible=true, input_class="form-control", rows="3", placeholder="Describe ideal market conditions (e.g., trending, ranging, high volatility)") }}
                {{ render_field(form.sub_optimal_market_conditions, label_visible=true, input_class="form-control", rows="3", placeholder="Describe conditions where this model should be avoided") }}
            </div>
        </div>

        <!-- Trading Strategy Module -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-bullseye module-icon"></i>
                    Strategic Trading Execution Framework
                </div>
                <div class="module-meta">Entry, Exit & Risk-Reward Configuration Management</div>
            </div>
            <div class="module-content">
                {{ render_field(form.entry_trigger_description, label_visible=true, input_class="form-control", rows="4", placeholder="Specific, objective conditions for entering a trade") }}
                {{ render_field(form.stop_loss_strategy, label_visible=true, input_class="form-control", rows="3", placeholder="e.g., ATR-based, fixed points, structure-based") }}
                {{ render_field(form.take_profit_strategy, label_visible=true, input_class="form-control", rows="3", placeholder="e.g., Fixed R:R, key levels, trailing stop") }}
                {{ render_field(form.min_risk_reward_ratio, label_visible=true, input_class="form-control", type="number", placeholder="e.g., 1.5 for 1.5:1") }}
            </div>
        </div>

        <!-- Risk Management Module -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-shield-alt module-icon"></i>
                    Enterprise Risk & Trade Management Framework
                </div>
                <div class="module-meta">Strategic Position Sizing & Trade Management Configuration</div>
            </div>
            <div class="module-content">
                {{ render_field(form.position_sizing_rules, label_visible=true, input_class="form-control", rows="3", placeholder="e.g., Max 1% of account per trade, fixed contract size") }}
                {{ render_field(form.scaling_in_out_rules, label_visible=true, input_class="form-control", rows="2", placeholder="Rules for adding to or reducing position size (if applicable)") }}
                {{ render_field(form.trade_management_breakeven_rules, label_visible=true, input_class="form-control", rows="2", placeholder="e.g., Move SL to breakeven when trade is +1R") }}
                {{ render_field(form.trade_management_trailing_stop_rules, label_visible=true, input_class="form-control", rows="2", placeholder="Rules for trailing stop-loss (if applicable)") }}
                {{ render_field(form.trade_management_partial_profit_rules, label_visible=true, input_class="form-control", rows="2", placeholder="Rules for taking partial profits (if applicable)") }}
                {{ render_field(form.trade_management_adverse_price_action, label_visible=true, input_class="form-control", rows="2", placeholder="How to react to unexpected adverse price moves") }}
            </div>
        </div>

        <!-- Risk Parameters Module -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-exclamation-triangle module-icon"></i>
                    Enterprise Risk Parameters Configuration
                </div>
                <div class="module-meta">Strategic Loss Limitation & Drawdown Management</div>
            </div>
            <div class="module-content">
                {{ render_field(form.model_max_loss_per_trade, label_visible=true, input_class="form-control", placeholder="e.g., 1% or $X") }}
                {{ render_field(form.model_max_daily_loss, label_visible=true, input_class="form-control", placeholder="e.g., 3% or $Y") }}
                {{ render_field(form.model_max_weekly_loss, label_visible=true, input_class="form-control", placeholder="e.g., 5%") }}
                {{ render_field(form.model_consecutive_loss_limit, label_visible=true, input_class="form-control", placeholder="e.g., 3 trades") }}
                {{ render_field(form.model_action_on_max_drawdown, label_visible=true, input_class="form-control", rows="3", placeholder="Action if max drawdown for this model is hit") }}
            </div>
        </div>

        <!-- Execution Framework Module -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-cogs module-icon"></i>
                    Strategic Execution & Operational Framework
                </div>
                <div class="module-meta">Enterprise Trading Execution & Quality Assurance Procedures</div>
            </div>
            <div class="module-content">
                {{ render_field(form.pre_trade_checklist, label_visible=true, input_class="form-control", rows="5", placeholder="One item per line for pre-trade checks specific to this model") }}
                {{ render_field(form.order_types_used, label_visible=true, input_class="form-control", rows="2", placeholder="e.g., Market, Limit, Stop Limit") }}
                {{ render_field(form.broker_platform_notes, label_visible=true, input_class="form-control", rows="2", placeholder="Any broker or platform specific considerations") }}
                {{ render_field(form.execution_confirmation_notes, label_visible=true, input_class="form-control", rows="2", placeholder="Steps to confirm after execution (e.g., SL/TP placed)") }}
                {{ render_field(form.post_trade_routine_model, label_visible=true, input_class="form-control", rows="3", placeholder="Model-specific steps for post-trade analysis") }}
            </div>
        </div>

        <!-- Model Analysis Module -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-microscope module-icon"></i>
                    Strategic Model Analysis & Refinement Framework
                </div>
                <div class="module-meta">Enterprise Performance Analysis & Continuous Improvement</div>
            </div>
            <div class="module-content">
                {{ render_field(form.strengths, label_visible=true, input_class="form-control", rows="3", placeholder="Perceived strengths of this model") }}
                {{ render_field(form.weaknesses, label_visible=true, input_class="form-control", rows="3", placeholder="Perceived weaknesses or areas for improvement") }}
                {{ render_field(form.backtesting_forwardtesting_notes, label_visible=true, input_class="form-control", rows="4", placeholder="Notes on backtesting or forward-testing results") }}
                {{ render_field(form.refinements_learnings, label_visible=true, input_class="form-control", rows="4", placeholder="Changes and learnings over time") }}
            </div>
        </div>

        <!-- Enterprise Form Actions -->
        <div class="enterprise-module mb-4">
            <div class="module-header">
                <div class="module-title">
                    <i class="fas fa-check-circle module-icon"></i>
                    Strategic Model Configuration Actions
                </div>
                <div class="module-meta">Enterprise Trading Model Deployment Controls</div>
            </div>
            <div class="module-content">
                <div class="d-flex gap-3 justify-content-center">
                    {{ form.submit(class="btn btn-primary btn-lg") }}
                    <a href="{{ url_for('trading_models.models_list') }}" class="btn btn-outline-secondary btn-lg">
                        <i class="fas fa-times me-2"></i>Cancel Configuration
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}